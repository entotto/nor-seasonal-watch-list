<!DOCTYPE html>
<html lang="en">
{% if user is defined %}
    {% set isDarkMode = user.getPreferences.isDarkMode %}
{% else %}
    {% set isDarkMode = false %}
{% endif %}
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="color-scheme" content="light dark">

        <script>
            // If `prefers-color-scheme` is not supported, fall back to light mode.
            // i.e. In this case, inject the `light` CSS before the others, with
            // no media filter so that it will be downloaded with highest priority.
            if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
                document.documentElement.style.display = "none";
                document.head.insertAdjacentHTML(
                    "beforeend",
                    "<link id=\"css\" rel=\"stylesheet\" href=\"/bootstrap/css/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
                );
            }
        </script>
        <!-- Load the alternate CSS first ... -->
        <link id="css-dark" rel="stylesheet" href="/css/bootstrap-night.css?v={{ asset_version }}" media="(prefers-color-scheme: dark)">
        <!-- ... and then the primary CSS last for a fallback on very old browsers that don't support media filtering -->
        <link id="css-light" rel="stylesheet" href="/bootstrap/css/bootstrap.css?v={{ asset_version }}" media="(prefers-color-scheme: light)">

        <script src="/js/ToggleDarkMode.js?v={{ asset_version }}" type="application/javascript"></script>

        {#        <link href="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@0.1/dist/css/bootstrap-dark.min.css" rel="stylesheet">#}

{#        <link href="/css/bootstrap-nightshade.min.css" rel="stylesheet">#}

{#        <link href="/bootstrap/css/bootstrap.min.css?v={{ asset_version }}" rel="stylesheet">#}
{#        {% if isDarkMode %}#}
{#            <link href="/css/darkly-bootstrap.min.css" rel="stylesheet">#}
{#        {% endif %}#}
        <link href="/bootstrap-icons/font/bootstrap-icons.css?v={{ asset_version }}" rel="stylesheet">
        <link href="/css/main.css?v={{ asset_version }}" rel="stylesheet">
{#        {% if isDarkMode %}#}
{#            <link href="/css/dark-main.css?v={{ asset_version }}" rel="stylesheet">#}
{#        {% endif %}#}

        <title>{% block title %}Seasonal Watch List{% endblock %}</title>

        <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">

        {% block stylesheets %}{% endblock %}

        {% block javascripts %}{% endblock %}
    </head>
    <body>
    <nav id="main_nav" class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <!--suppress CheckImageSize -->
                <img src="/img/NOR_symbol_40_invert_transparent.png" alt="NOR" width="40px" class="d-inline p-1">
                Seasonal Watch List
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    {% if app.user and is_granted('ROLE_SWL_USER') %}
                        <li class="nav-item">
                            <a class="nav-link {% if app.request.pathinfo == '/personal/watch' %}active{% endif %}" href="{{ path('my_watch_index') }}">Personal</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if app.request.pathinfo == '/community/watch' %}active{% endif %}" href="{{ path('all_watch_index') }}">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if app.request.pathinfo == '/vote' %}active{% endif %}" href="{{ path('my_vote') }}">Vote</a>
                        </li>
                        {% if is_granted('ROLE_SWL_ADMIN') %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle {% if app.request.pathinfo starts with '/admin/' %}active{% endif %}" href="#" id="navbarDropdown" role="button"
                                   data-bs-toggle="dropdown" aria-expanded="false">
                                    Manage
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <li>
                                        <a class="dropdown-item {% if app.request.pathinfo == '/admin/season/' %}active{% endif %}" href="{{ path('admin_season_index') }}">Seasons</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item {% if app.request.pathinfo == '/admin/show/' %}active{% endif %}" href="{{ path('admin_show_index') }}">Shows</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item {% if app.request.pathinfo == '/admin/election/' %}active{% endif %}" href="{{ path('admin_election_index') }}">Elections</a>
                                    </li>
                                </ul>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                {% if app.user %}
                <ul class="navbar-nav navbar-right mb-2 mb-md-0">
                    <li class="nav-item me-2">
                        <div class="btn-group ms-auto d-none d-md-inline" role="group">
                            <a id="darkmode-button" class="btn btn-outline-secondary">
                                <i class="bi bi-moon d-none d-light-inline" title="Switch to dark mode"></i>
                                <i class="bi bi-sun d-none d-dark-inline" title="Switch to light mode"></i>
                            </a>
                        </div>
                        <a id="darkmode-menu-toggle" class="nav-link d-md-none" href="#">
                            <span class="d-none d-light-inline">Switch to dark mode</span>
                            <span class="d-none d-dark-inline">Switch to light mode</span>
                        </a>

                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('connect_discord_disconnect') }}">Logout</a>
                    </li>
                </ul>
                {% endif %}
            </div>
        </div>
    </nav>
    {% block second_navbar %}{% endblock %}
    <div class="container">
        {% block body %}{% endblock %}
    </div>
    <script src="/js/jquery.min.js?v={{ asset_version }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
    <script src="/bootstrap/js/bootstrap.bundle.min.js?v={{ asset_version }}"></script>
{#    <script src="/js/darkmode.min.js"></script>#}
{#    <script src="/js/datatables.min.js"></script>#}
{#    <script src="/js/jquery.dataTables.min.js"></script>#}
{#    <script src="/js/dataTables.bootstrap5.min.js"></script>#}
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}?v={{ asset_version }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}&v={{ asset_version }}"></script>
    <!--suppress BadExpressionStatementJS -->
    <script type="application/javascript">
        const isDarkMode ={% if isDarkMode %} true {% else %} false {% endif %}
    </script>
    <script>
        // document.querySelector("#darkmode-button").onclick = function(e){
        //     darkmode.toggleDarkMode()
        // }
        document.querySelector("#darkmode-menu-toggle").onclick = function(e){
            e.preventDefault()
            darkmode.toggleDarkMode()
            const mainNav = document.getElementById('main_nav')
            const elements = mainNav.getElementsByClassName('navbar-toggler')
            elements[0].click()
        }
    </script>
    {% block body_javascripts %}{% endblock %}
    </body>
</html>
